# Торговая стратегия основанная на скользящих медианах

## Описание торговой системы

Данная торговая система включает в себя свод правил, по которым торговый робот принимает решения об открытии позиций по финансовым инструментам. Данная документация содержит следующие разделы:

-   Риск-менеджмент;
-   Описание торговой стратегии, применяемой в данной системе;
-   Условия открытия позиции;
-   Условия закрытия позиции;
-   Блок-схема алгоритма.
    
### Риск-менеджмент

Произведем расчет максимального объема позиции при установленных рисках. Установленный риск на сделку составляет 2% от общей суммы счета.

Для расчета нам потребуются следующие данные:

1)	Размер депозита
2)	Процент допустимого риска на сделку
3)	Цена входа
4)	Цена стоп-лосса
5)	Шаг цены
6)	Стоимость шага цены
7)	Гарантийное обеспечение (ГО)

Из представленных пунктов информацию о шаге цены, стоимости шага цены и ГО берем с сайта Московской Биржи в разделе спецификации контракта (в данном случае рассатривается работа с производными инструментами на Московсвкой Бирже).

Далее, по шагово разбирается расчет максимального объема позиции на одну сделку.

Рассчитываем допустимый риск на сделку в рублях, в зависимости от указанного процента риска:

![alt text](https://github.com/klim2552/bablorez/blob/master/data/rm1.png)

Рассчитываем SL в пунктах:

![alt text](https://github.com/klim2552/bablorez/blob/master/data/rm2.png)

Рассчитываем SL в денежном эквиваленте:

![alt text](https://github.com/klim2552/bablorez/blob/master/data/rm3.png)

Рассчитываем торговый лот на сделку:

![alt text](https://github.com/klim2552/bablorez/blob/master/data/rm4.png)

Готовый пример таких расчетов можно взять по этой [ссылке](https://docs.google.com/spreadsheets/d/1ex7q2S1piAyN6AR91kybN_nckibj4G8AilN7jLPYyyM/edit?usp=sharing).


### Описание торговой стратегии, применяемой в данной системе

Торговая стратегия основана основана на индикаторе технического анализа "Канал относительной волатильности". Суть данного индикатора строится на предположении, что цена финансового инструмента, по достижению границы канала или его пересечении, направиться в сторону другой границы канала.

Наглядно, это можно увидеть на рисунке ниже:
![alt text](https://github.com/klim2552/bablorez/blob/master/data/MM.JPG)

Здесь, "Канал относительной волатильности" образуют красная и синяя линии. Желтая линия является ценой финансового инструмента.

#### Описание индикатора.
"Канал относительной волатильности" строится по двум скользящим медианам.Методика расчета каждой из них следующая:

Скользящая медиана минимумов:

![alt text](https://github.com/klim2552/bablorez/blob/master/data/eqn.png) , где x - это значение минимума, а n число значений.

Скользящая медиана максимумов:

![alt text](https://github.com/klim2552/bablorez/blob/master/data/eqn1.png) , где x - это значение максимума, а n число значений.

Расчет медианы можно производить и по другой формуле, но за основу берется именно эта, так как, по умолчанию предполагется, что скользящие медианы беруться по 10 значениям цен (n = 10), так как n является четным - используется данная методика расчета медианы.

Использование скользящей медианы вместо скользящей средней обусловлено тем, что скользящая медиана способна улавливать с наименьшей погрешностью видоизменения цен и давать более точные сигналы для открытия позиций. 

В  зависимости от финансового инструмента, применяемого для торговли к формуле расчета может добавляться стандартное отклонение по 10 значениям. Стоит отметить важную особенность добавления стандратного отклонения в формулу расчета: При добавлении данной переменной, "канал относительной волатильности" расширяется, чото приводит к тому, что в большинстве случаев, цена не достигает его и сигнала на открытие позиции нет. Добавление стандартного отклонения к данному индикатору будет оправдано на активах с высокой волатильностью. 

#### Принцип открытия и закрытия позиций
Для принятия решения по открытию позиций система имеет следующий алгоритм:

 Шаг 1:
>       а) Если цена достигает или пересекает скользящую медиану максимумов в "Канале относительной волатильности", то открывается
>          сделка Short.
>
>       б) Если цена достигает или пересекает скользящую медиану минимумов в "Канале относительной волатильности", то открывается
>          сделка Long.

Шаг 2:
>       Выставить SL согласно Риск-менеджменту сразу после открытия позиции с риском 2% на сделку от общего счета.

Шаг 3:
>       Выставить TP согласно Риск-менеджменту сразу после открытия позиции с соотношением 3:1 (прибыль : риск) на сделку от общего
>       счета.

Шаг 4:
>       По достижению TP и SL закрыть сделку.

Данный алгоритм является упрощенной моделью и служит для ознакомления, более подробный можно увидеть в следующем пункте в виде блок-схемы.

### Условия открытия позиции

Позиция может быть открыта вслучае, если выполнены все изложенные ниже условия:

1) Отклонение цены от основной тенденции не превышает допустимого значения.
2) Отсутствует важная информация, способная повлиять на цену финансового инструмента внутри дня.
3) Финансовый инструмент является ликвидным.
4) Необходимое гарантийное обеспечение (ГО) по финансовому инструменту является допустимым для открытия позиции на используемом счете.
5) Финансовый инструмент волатилен внутри дня.
6) По финансовому инструменту разрешены сделки типа Short.
7) Время открытия поозиции не совпдает с временем клиринга на бирже.

Позиция может быть открыта при наличии уже открытых позиций только в случае, если выполнены следующие условия:

1) Количество открытых позиций не превышает разрешенное, согласно регламенту.
2) Открываемая позиция не усредняет уже открытую (запрещено открывать несколько сделок одного типа, если хоть одна из них является убыточной).
3) Размер позиции не превышает разрешенный, согласно регламенту.

### Условия закрытия позиции

Позиция должна быть закрыта в случае, если выполняюся следующие условия:

1) Цена финансового инструмента достигла уровня TP или SL.
2) Цена финансового инструмента не достигла уровня TP или SL к концу дня.

### Блок-схема алгоритма

![alt text](https://github.com/klim2552/bablorez/blob/master/data/TC.png)
